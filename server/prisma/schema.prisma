generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum LeadStage {
  NA_BASE
  EM_CONTATO
  COMPRADO
  REJEITADO
}

model Lead {
  id           String    @id @default(cuid())
  nome         String
  whatsapp     String
  createdAt    DateTime  @default(now()) @map("created_at")
  referralCode String?   @map("referral_code")
  ip           String?
  userAgent    String?   @map("user_agent")
  stage        LeadStage @default(NA_BASE)

  @@map("Lead")
  @@index([stage])
  @@index([referralCode])
}

model Referrer {
  id           String   @id @default(cuid())
  nome         String
  whatsapp     String
  referralCode String   @map("referral_code")
  createdAt    DateTime @default(now()) @map("created_at")

  @@map("Referrer")
  @@unique([referralCode])
}

model ReferralHit {
  id           String   @id @default(cuid())
  referralCode String   @map("referral_code")
  ip           String
  userAgent    String   @map("user_agent")
  createdAt    DateTime @default(now()) @map("created_at")

  // Dados de Navegação
  referrer     String?  // Domínio de origem (ex: "google.com", "facebook.com")
  utmSource    String?  @map("utm_source")
  utmMedium    String?  @map("utm_medium")
  utmCampaign  String?  @map("utm_campaign")

  // Dados de Dispositivo
  deviceType   String?  @map("device_type") // "mobile", "desktop", "tablet"
  os           String?  // "Windows", "macOS", "Android", "iOS", etc
  browser      String?  // "Chrome", "Firefox", "Safari", "Edge", etc
  screenWidth  Int?     @map("screen_width")
  screenHeight Int?     @map("screen_height")

  // Localização (via IP)
  country      String?  // Código do país (ex: "BR", "US")
  city         String?
  region       String?

  // Dados Técnicos
  language     String?
  timezone     String?

  @@map("ReferralHit")
  @@index([referralCode])
  @@index([createdAt])
  @@index([deviceType])
  @@index([country])
}

